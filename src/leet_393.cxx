#include <leetall.h>

unsigned char GetStart(unsigned char in, size_t bitnum)
{
    return (in >> (8 - bitnum));
}

bool validUtf8(vector<int>& data) {
    vector<unsigned char> cdata;
    for (auto i : data) {
        cdata.push_back((unsigned char)i);
    }
    int len = cdata.size();
    for (int i = 0; i < len;) {
        if (GetStart(cdata[i], 1) == 0) {
            fmt::print("{} is 1\n", i);
            i += 1;
        } else if (GetStart(cdata[i], 3) == 0b110) {
            if (i + 2 > len || GetStart(cdata[i + 1], 2) != 0b10) {
                return false;
            }
            fmt::print("{} is 2\n", i);
            i += 2;
        } else if (GetStart(cdata[i], 4) == 0b1110) {
            if (i + 3 > len || GetStart(cdata[i + 1], 2) != 0b10 || GetStart(cdata[i + 2], 2) != 0b10)  {
                return false;
            }
            fmt::print("{} is 3\n", i);
            i += 3;
        } else if (GetStart(cdata[i], 5) == 0b11110) {
            if (i + 4 > len || GetStart(cdata[i + 1], 2) != 0b10 || GetStart(cdata[i + 2], 2) != 0b10 || GetStart(cdata[i + 3], 2) != 0b10)  {
                return false;
            }
            fmt::print("{} is 4\n", i);
            i += 4;
        } else {
            fmt::print("{} is invalid\n", i);
            return false;
        }
    }
    return true;
}

void test()
{
    vector<int> tin = {55,210,160,236,135,169,86,215,156,232,153,147,222,138,233,180,186,95,244,153,156,191,85,225,136,155,55,221,181,221,167,236,167,166,244,191,140,179,8,233,149,181,204,173,243,141,185,187,47,230,163,152,247,136,172,163,20,198,182,225,169,147,229,156,149,247,173,183,167,74,228,131,137,234,144,137,234,136,165,247,155,148,185,215,188,234,145,172,46,218,169,228,149,130,239,141,149,241,142,129,178,227,133,170,6,199,165,236,160,128,217,160,34,203,167,233,149,175,241,187,159,186,239,158,135,241,169,129,152,54,241,188,184,184,78,220,167,236,161,142,91,234,139,166,243,136,141,153,200,139,78,243,137,151,154,209,188,236,135,178,243,187,148,132,43,235,186,155,41,227,149,191,240,142,186,140,238,191,136,207,180,234,175,158,214,157,236,156,155,236,188,147,125,214,146,212,158,208,180,235,144,144,240,149,174,181,229,175,154,238,146,163,247,161,183,136,46,238,158,180,244,169,188,132,204,177,242,161,143,168,213,172,229,166,138,240,176,142,136,204,150,236,186,166,228,152,146,35,233,147,132,54,225,191,189,243,154,177,146,238,149,172,198,152,243,152,168,167,223,191,54,238,163,136,78,192,186,231,174,165,204,186,227,144,150,247,165,142,191,92,236,144,187,243,185,137,162,7,195,152,242,152,146,162,236,153,155,28,231,181,165,246,135,161,181,199,143,233,167,155,54,239,134,177,247,142,184,185,95,230,152,161,246,154,156,189,222,178,231,168,166,227,188,181,241,162,188,152,232,158,138,74,203,188,220,142,233,178,169,226,191,173,49,218,141,228,142,146,242,149,165,173,59,218,173,232,188,180,247,151,152,181,122,57,218,186,239,159,173,241,168,164,187,226,189,154,245,143,131,156,28,228,183,186,208,167,240,148,173,166,120,226,190,163,241,191,171,158,35,192,158,225,152,170,240,154,147,144,246,181,159,129,245,146,156,182,233,167,172,236,141,156,33,242,140,171,136,31,230,130,133,247,163,171,171,94,239,160,128,246,142,165,159,43,192,173,239,131,177,246,182,181,181,233,157,158,243,132,190,137,231,130,154,244,128,161,170,230,143,189,247,154,178,160,63,238,171,144,192,166};
    // vector<int> ttin = {238,171,144};
    fmt::print("len = {}\n", tin.size());
    bool t = validUtf8(tin);
    fmt::print("{} \n", t);
}

int main()
{
    test();
    return 0;
}